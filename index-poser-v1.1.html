<!DOCTYPE html>
<html>
<head>

    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <meta name="description" contents="{{description}}">
    <link rel="manifest" href="/manifest.json">
    <title>Avatar Body Poser (v1.1)</title>
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/bootbox-dialoges.css">
    <link rel="stylesheet" href="/css/side-panels.css">
    <link rel="stylesheet" href="/css/messg.css" >
    <link rel="stylesheet" href="/css/spectrum.css">
    <link rel="stylesheet" href="/css/colorpicker.css">
    <link rel="stylesheet" href="/css/spinner.css">
    <link rel="stylesheet" href="/css/jquery-ui.css">
    <link rel="stylesheet" href="/css/alerts.css">
    <link rel="stylesheet" href="/css/panel-ui.css">
    <link rel="stylesheet" href="/css/anywhere3d.css">
    <link rel="stylesheet" href="/css/joystick.css">
    <link rel="stylesheet" href="/css/uppy.css">
    <link rel="stylesheet" href="/css/jquery.Jcrop.css">

                <!-- JQUERY -->
    
    <script src="/js/jquery.min.js"></script>
    <script src="/js/jquery.lazy.js"></script>
    <script src="/js/jquery.lazy.plugins.js"></script>
    <script src="/js/jquery-ui.js"></script>
    <script src="/js/jquery.Jcrop.js"></script>
    
    <script>
    
        debugMode = true;
        var jsFolder = "/js/";
        var navbarFolder = "/navbar/";
        var scriptsFolder = "/scripts/";
        var componentsFolder = "/components/";
        var animationsFolder = "/animations/";
        $.ajaxSetup({ cache: false });
    
    </script>

</head>


<nav class="navbar navbar-default navbar-fixed-top">

    <div id="navbar-holder" class="container"></div>

    <script>
    //  navbar poser.html
        var navbarHolderSelector = "#navbar-holder";
        var navbarComponent = navbarFolder + "navbar-poser.html";
        $(navbarHolderSelector).load(navbarComponent, function(response, status, xhr){
            debugMode && console.log("navbar-poser:", status);
        });
    </script>

</nav>


<!-- style>
    .navbar-nav > li > a.menu-item,
    .navbar-nav > li > div > a.menu-item {font-weight:normal;}
    .navbar-nav > li > a.menu-item:hover,
    .navbar-nav > li > div > a.menu-item:hover {color:aquamarine;}
    .navbar-nav > li > div > a.menu-item { text-decoration:none }
    #nav-btn-login { margin-left:10px; }
    #nav-btn-login > a { color:#fff; font-weight:bold; font-size:14px; text-decoration:none; }
    #nav-btn-snapshot > a { color:#38c0ee; }
</style -->

<!-- 
    <nav class="navbar navbar-default navbar-fixed-top">
    
        <div class="container"></div>
    
            <div class="navbar-header">
                <div class="navbar-brand">
                    <a href="https://anywhere3d.org" class="navbar-caption" title="anywhere3d.org">anywhere3d</a>
                </div>
                <a class="navbar-logo pull-left"><img src="https://i.imgur.com/09bC4Q0.png" alt="anywhere3d logo"></a>
                <ul class="nav navbar-nav navbar-right pull-left">
                    
                    <li class="first menu-item"></li>
    
                    <li id="nav-item-over" style="display:none;"><a class="menu-item">Overview</a></li>
                    <li id="nav-item-home" style="display:none;"><a class="menu-item">Home</a></li>
                    <li id="nav-item-dash" style="display:none;"><a class="menu-item">Dashboard</a></li>
                    <li id="nav-item-exam" style="display:none;"><a class="menu-item">Examples</a></li>
                    <li id="nav-item-forum"><a href="http://anywhere3d.freeforums.net" target="_blank" class="menu-item">Forum</a></li>
    
                </ul>
            </div>
    
            <ul class="nav navbar-nav navbar-right">
    
                <li class="pull-right">
                    <div class="navbar-btn btn btn-primary btn-white-outline" id="nav-btn-login" style="display:none;">
                        <a class="menu-item">Login</a>
                    </div>
                </li>
    
            </ul>
    
        </div>
     
    </nav>
 -->


<style>
    body { margin:0px; height:100vh; overflow:hidden; font-family: Arial, sans-serif; }
    canvas { display:block !important; }
    #body-section { 
        height:100%; padding-top:0px; padding-bottom:0px; 
        background-color:rgba(0,0,0,1); overflow:hidden; 
    }
    #render-container { 
        width:100%; height:100%; 
        opacity:1; background-color:rgb(0,0,0); 
    }
    #splash-holder,
    #auth-holder { 
        position:absolute; left:0px; top:0px; width:100%; height:100%;
        text-align:center; background-color:rgba(255,255,255,0); z-index:1; 
    }
    .twitter-holder { text-align:center; margin:10px 0px; }    
    .patreon-holder { display:none; text-align:center; }
    #joystick1, #joystick2, #jumpButton  { z-index:0 !important; }
    .menu-helpers a,
    .editor-helpers a,
    .mode-helpers a,
    .updater-helpers a,
    .helpers a { font:bold 16px Arial; cursor:pointer; text-decoration:none; }
    .mode-helper a { color:fuchsia; }
    .ui-dialog { opacity:1 !important; }
    .non-ready { display:none; }
    .updater   { cursor:pointer; }
    
    .side-holder { width:84%; margin-bottom:10px; }

</style>

<section class="mbr-section mbr-after-navbar" id="body-section">

    <div id="render-container" class="mbr-overlay"></div>

    <div class="joystick-controls" id="joystick-controls-1"></div>
    <div class="joystick-controls" id="joystick-controls-2"></div>

    <div class="side-panel" id="left-side">
        <div id="left-side-pinbtn" title="click this to pin/unpin panel"></div>

        <div id="left-side-content">

            <div id="avatar-editor-left-panel">

                <div id="chatboard-holder"></div>

            </div>
            
            <div id="display-helpers-holder">
                <li id="display-helpers" class="menu-helpers"><a>Display Helpers</a></li>
            </div>

            <div class="twitter-holder">
                <a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class="twitter-share-button" data-url="http://anywhere3d.com" data-lang="en" data-show-count="false">Tweet</a>
                <a href="https://twitter.com/anywhere3d?ref_src=twsrc%5Etfw" class="twitter-follow-button" data-show-screen-name="false" data-lang="en" data-show-count="false">Follow</a>
                <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
            </div>

        </div>

    </div>

    <div class="side-panel" id="right-side">
        <div id="right-side-pinbtn" title="click this to pin/unpin panel"></div>

        <div id="right-side-content">

            <div id="actions-holder">
                <li id="action-controls" class="menu-helpers"><a>Action Controls</a></li>
            </div>

            <div id="pose-load-file-holder" class="side-holder"></div>
            <div id="skinned-loader-holder" class="side-holder"></div>
            <div id="avatar-editor-holder"  class="side-holder"></div>
            <div id="outfit-editor-holder"  class="side-holder"></div>
            <div id="pose-editor-holder" class="side-holder"></div>
            <div id="pose-save-file-holder" class="side-holder"></div>
            <div id="pose-save-storage-holder" class="side-holder"></div>
            <div id="snapshot-holder" class="side-holder"></div>
            <div id="mask-button-holder" class="side-holder"></div>

            <div id="editor-holder"></div>
            <div id="scene-editor-holder"></div>
            <div id="avatar-save-button-holder"></div>
            <div id="scene-window-holder"></div>
            <div id="outfit-saver-holder"></div>
            <div id="water-editor-holder"></div>

        </div>
    </div>

</section>

<!-- script src="/js/w3.js"></script -->


            <!-- ZANGO DB -->

<!-- For certain web browsers, such as Internet Explorer,
the Babel polyfill is required and must be loaded before ZangoDB. -->
<!-- script src="https://cdnjs.cloudflare.com/ajax/libs/babel-polyfill/6.23.0/polyfill.min.js"></script -->

<!-- MongoDB-like interface for IndexedDB. -->
<script src="/js/zangodb.min.js"></script>
<script src="/js/anywheredb.js"></script>

<!-- script src="https://unpkg.com/zangodb@latest/dist/zangodb.min.js"></script -->

<script>
/*
    var db_NAME = "anywheredb";
    var db_VERSION = 2;

    var db = new zango.Db( db_NAME, db_VERSION, {
        user: true,
        objects: true,
        geometries: true,
        materials: true,
        textures: true,
        images: true,
        files: true,
        assets: true,
        avatars: true,
        outfits: true,
        bones: true,
        poses: true,
        animations: true,
        snapshots: true,
        gallery: true,
        players: true,
        scenes: true,
        demo: true,
        scratchpad: true,
    });

    db.open(function(err){

        if (err) {
            console.log( err );
        } else {
    
            console.log("Collections:");

            User = db.collection('user');              console.log(User.name );
            Objects = db.collection('objects');        console.log(Objects.name );
            Geometries = db.collection('geometries');  console.log(Geometries.name );
            Materials = db.collection('materials');    console.log(Materials.name );
            Textures = db.collection('textures');      console.log(Textures.name );
            Images = db.collection('images');          console.log(Images.name );
            Files = db.collection('files');            console.log(Files.name );
            Assets = db.collection('assets');          console.log(Assets.name );
            Avatars = db.collection('avatars');        console.log(Avatars.name );
            Outfits = db.collection('outfits');        console.log(Outfits.name );
            Bones = db.collection('bones');            console.log(Bones.name );
            Poses = db.collection('poses');            console.log(Poses.name );
            Animations = db.collection('animations');  console.log(Animations.name );
            Snapshots = db.collection('snapshots');    console.log(Snapshots.name );
            Gallery = db.collection('gallery');        console.log(Gallery.name );
            Players = db.collection('players');        console.log(Players.name );
            Scenes = db.collection('scenes');          console.log(Scenes.name );
            Demo = db.collection('demo');              console.log(Demo.name );
            Scratchpad = db.collection('scratchpad');  console.log(Scratchpad.name );

            console.log("Database %s opened and ready for use.", db.name);
        }
    });
*/
</script>

        <!-- LOCAL FORAGE -->

<script src="/js/localforage.js"></script>

<script>

    var CacheStorage = localforage.createInstance({
        driver: localforage.INDEXEDDB,
        name: "anywhere3d",
        storeName: "cache",
        version: 1.0
    });

    CacheStorage.ready().then(function() {
        console.log("[CacheStorage ready]:", CacheStorage.driver()); // <-- asyncStorage
    }).catch(function (err) {
        console.error("[CacheStorage Error]:", err); 
    });

</script>

      <!-- LOCAL STORAGE -->

<script src="/js/store2.js"></script>
<script src="/js/store.on.js"></script>
<script src="/js/store.array.js"></script>

    <!-- INFLATE - DEFLATE -->

<script src="/js/rawinflate.js"></script>
<script src="/js/rawdeflate.js"></script>

<script>

    function encode( string ) {
        return window.btoa( RawDeflate.deflate( string ) );
    }

    function decode( string ) {
        return RawDeflate.inflate( window.atob( string ) );
    }

//  Samples:

    function getDecodedItemFromLocalStorage( key ){
        return JSON.parse( RawDeflate.inflate( window.atob( localStorage.getItem( key ) ) ) );
    }

    function setEncodedItemToLocalStorage(key, data){
        localStorage.setItem(key, window.btoa( RawDeflate.deflate( JSON.stringify( data ) ) ) );
    }

</script>

<script src="/js/validator.min.js"></script>
<script async src="/js/alerts.js"></script>
<script async src="/js/bootbox.min.js"></script>
<script async src="/js/bootstrap.min.js"></script>
<script async src="/js/DeviceDetector.js"></script>
<script async src="/js/MathDecimalAdjustment.js"></script>
<script async src="/js/html2canvas.js"></script>
<script async src="/js/spectrum.js"></script>
<script async src="/js/watermark.js"></script>
<script async src="/js/sharer.js"></script>
<script async src="/js/helpers.js"></script>
<script async src="/js/side-panels.js"></script>

        <!-- THREEJS -->

<script src="/three/three.js"></script>
<script src="/three/EditorControls.js"></script>
<script src="/three/Detector.js"></script>
<script src="/three/Projector.js"></script>
<script src="/three/Animation.js"></script>
<script src="/three/AnimationHandler.js"></script>
<script src="/three/KeyFrameAnimation.js"></script>

<script>
    THREE.Cache.enabled = true;
    THREE.Texture.DEFAULT_IMAGE = "https://i.imgur.com/8eycYxu.png";
</script>

       <!-- MESHWALK -->

<script src="/js/MW.js"></script>
<script src="/js/MWtps.js"></script>
<script src="/js/VirtualInput.js"></script>

        <!-- SCENE -->

<script src="/js/scene-helpers.js"></script>
<script src="/js/scene.js"></script>
<script src="/js/EdgesHelper.js"></script>

        <!-- AW3D -->

<script src="/js/AW3D.js"></script>
<script src="/js/PlayerController.js"></script>
<script src="/js/PlayerLabel.js"></script>
<script src="/js/KeyInputControls.js"></script>
<script src="/js/JoystickControls.js"></script>
<script src="/js/outfitLoader.js"></script>
<script src="/js/loaders/bonesLoader.js"></script>

<script>

    var Animations       = {}; // object.
    var MaleAnimations   = {}; // object.
    var FemaleAnimations = {}; // object.

</script>


     <!-- COMPONENTS -->

<script src="/js/form-panel.js"></script>
<script src="/js/editor-panel.js"></script>
<script src="/js/snapshot-panel.js"></script>
<script src="/js/dialogTargetEventListeners.js"></script>

<script>
//  display-helpers.html
    var displayHelpersSelector = "#display-helpers";
    var displayHelpersHolderSelector = "#display-helpers-holder";
    var displayHelpersComponent = componentsFolder + "display-helpers.html";
    $(displayHelpersHolderSelector).load(displayHelpersComponent, function(response, status, xhr){
        debugMode && console.log("display-helpers:", status);
    });
</script>

<script>
//  skinned-loader-button.html
    var skinnedLoaderHolderSelector = "#skinned-loader-holder";
    var skinnedLoaderButtonComponent = componentsFolder + "skinned-loader-button.html";
    $(skinnedLoaderHolderSelector).load(skinnedLoaderButtonComponent, function(response, status, xhr){
        debugMode && console.log("skinned-loader-button:", status);
    });
</script>

<script>
/*
//  avatar-skin-editor-button.html
    var avatarEditorHolderSelector = "#avatar-editor-holder";
    var skinEditorButtonComponent = componentsFolder + "avatar-skin-editor-button.html";
    $(avatarEditorHolderSelector).load(skinEditorButtonComponent, function(response, status, xhr){
        debugMode && console.log("avatar-skin-editor-button:", status);
    });
*/
</script>

<script>
/*
//  outfit-dress-editor-button.html
    var outfitEditorHolderSelector = "#outfit-editor-holder";
    var dressEditorButtonComponent = componentsFolder + "outfit-dress-editor-button.html";
    $(outfitEditorHolderSelector).load(dressEditorButtonComponent, function(response, status, xhr){
        debugMode && console.log("outfit-dress-editor-button:", status);
    });
*/
</script>

<script>
//  pose-load-file-button.html
    var poseLoadFileHolderSelector = "#pose-load-file-holder";
    var poseLoadFileButtonComponent = componentsFolder + "pose-load-file-button.html";
    $(poseLoadFileHolderSelector).load(poseLoadFileButtonComponent, function(response, status, xhr){
        debugMode && console.log("pose-load-file-button:", status);
    });
</script>

<script>
//  pose-editor-button.html
    var poseEditorHolderSelector = "#pose-editor-holder";
    var poseEditorButtonComponent = componentsFolder + "pose-editor-button.html";
    $(poseEditorHolderSelector).load(poseEditorButtonComponent, function(response, status, xhr){
        debugMode && console.log("pose-editor-button:", status);
    });
</script>

<script>
//  pose-save-file-button.html
    var poseSaveFileHolderSelector = "#pose-save-file-holder";
    var poseSaveFileButtonComponent = componentsFolder + "pose-save-file-button.html";
    $(poseSaveFileHolderSelector).load(poseSaveFileButtonComponent, function(response, status, xhr){
        debugMode && console.log("pose-save-file-button:", status);
    });
</script>

<script>
//  pose-save-storage-button.html
    var poseSaveStorageHolderSelector = "#pose-save-storage-holder";
    var poseSaveStorageButtonComponent = componentsFolder + "pose-save-storage-button.html";
    $(poseSaveStorageHolderSelector).load(poseSaveStorageButtonComponent, function(response, status, xhr){
        debugMode && console.log("pose-save-storage-button:", status);
    });
</script>

<script>
/*
//  dress-mask-button.html
    var maskButtonHolderSelector = "#mask-button-holder";
    var maskFormButtonComponent = componentsFolder + "mask-form-button.html";
    $(maskButtonHolderSelector).load(maskFormButtonComponent, function(response, status, xhr){
        debugMode && console.log("dress-mask-button:", status);
    });
*/
</script>

<script>
//  snapshot-crop-button.html
    var snapshotHolderSelector = "#snapshot-holder";
    var snapshotCropButtonComponent = componentsFolder + "snapshot-crop-button.html";
    $(snapshotHolderSelector).load(snapshotCropButtonComponent, function(response, status, xhr){
        debugMode && console.log("snapshot-crop-button:", status);
    });
</script>

    <!-- RUNTIME ENGINE -->

<script src="/js/jquery-update-engine.js"></script>
<script src="/js/jquery-render-engine.js"></script>

<script>

//  Avatar loader.js

//  female dress outfit.
    var dna = "tVVdb5swFP0vPMfEBowhb3yq25qpXR66bqoiCC645auYdIqi/PddIFqL0rVZlImna5977XvOPXirxFWyUWZbpYwKrsyGcKI8CyniHBbaZs0nilxFXfCTTOC7mygprwreNpCoTOWjKEueTC/CpQvJl9GGN0vH/YKN5TPW1AcJ5Yqo5Y2Icgk1tkq7qbuj5lxmizYqk6hJ5ntAj61hM2vbWs6mU6GKIl036qoqpvW3W+/2MVYf6hRwvBBSimc+/yve/x5ffGb5Hl/VrahK2fW6XosEciyL+ZZmMeSbvo8M7NjI8TWMcGAxNwgp1QiFxD0z0N8CWn1101WVV40yIyZjDKBAk0gAibuzopVogR4Ci1mUiDJVZtrLnWGDMGaaNmB7/nrAwHXbRKWso4aXrTK7B85granWaVZyCbfHqgkc8TbK9/FL1U9ly0s5nLvbTU4neiHo9U2O1bo8jugx/pBo4nqmF+oMEZ0EyLBDIFq3bEQptgPH0DziOiOigw2XZyLa1phpEf0EnumY5y5+m+m73UTJItHIVz4a4lONdNFlz3ki1sUy/B9W8n8lN5dNvFcsXhf1OzYaYQ/V9cEzxMUB8nzsIMMJNWRbmoZcz7Id5lHHMvWRul13Z1L3FP+8oWtHwGKQBquYDpImTQ/4I+kQnyqp32X3YlIQUz+nmJf4+upGM44Sc4z92Npj/KH41Ahd4ng28i1CkWE6OrIJ/E1D5nrMx7oduOZI/J6HM6kPU6Zjm30wA8PSP4wA6mbgPbPLrOKvJ2OIT52MRSd1vuhq9O+meYTZr7KqTI8ajvbh64+n+Gn/CL4/HGPsodhm6AQhwxh5YciQodkExLZ8RIlh6tTTKNWN8YPZt3aE3NoZzf6mmVNeJhwOVu550W3tfgM="

    localPlayer.fromDNA( dna );

</script>

<script>

//  default pose.js

//  male pose.
    var hm_pose = "vVa7bhwxDPwX1zqB70d+xXCVNoCDOF2Qf89IewkuhY1b2PBts9KJ5HA4pPbx18P355eHL48XmoSf5OCawspjb3Dn03j48fwTR2ish7F++foNax54nn6Pvy7+ecCLO2keLoj6bhc83VprXGQau8fyYMxyv4eVh4xLIgdXHVgKVdiJJPQwb4tY5pasccKcuyyXoZtLD5lS8PSZJF54mr6fxX4Hi5d30rjsyXVbllbX5rGIP5hH8IKtFAkBPlXK5XZ2N3drk6njxd/kybSwCRsXWXjRMl1+impuX0ohlMjH4TPl/lTX/2eICXBriMfktZXK3DfhJimS6a4INt7sjNc2SahNsOMV4sZSm77C4ZTgcPZ4u1eV1MZSbNKaOQa7usUiUdVSHsYdtBXBpN5CgjCBIKQbCUMfUtgmLUI1eyMxoEILkEng7AdxKBPxqwEbNNiWd+V/o3KCoSqOWjoCLpeFMUQsALrZFj+2TcPCvJhLzQp+cDA9mlwoNUGkvQ7bJiO73aAUtloNneqpJ/SnM7o29RQOpEgqFaSfEjB0ABQ0rreI6Qk5unek7L6TIDTPZ0U+VfI1S8NDjpprXYtOt0NxUjkmBq4wyA5FDd6wEotsFJSUM3NRjb4o46yoSMuyVXPD1IBclhJKNwuvIDmKXteia+Queoven/tlVz1340QA6qo6+uks91D0Ltz6UvBTksHdyHZMW/RE2qm74XTkpz8=";
//  female pose.
    var fm_pose = "vVXLbtwwDPyXPcsC34/+SrCnXAukaHor+u8l5U3aHFLYDbLWxbKlITkzoh5+Xr49PV++PGwwoR7ygTkNGfL1sbH+Yfp1XL4//ajVMHpgzZ8fv9YcR43rr/GC9gpWL6rAvkMA5GEInCrJMTaagqorCUGk4whdEo3NJ6Eyj5oShMmJInjfnmLW28WR7c/2WSQBWqawS4rLwoOZiqCmaFRvyvqPAJgh3tAqSjloUlSse9K84RT+OM/5AZ63Tye6I4Dywg6OjMV0AN6V6SaWoz7OTCXqZOpMZegpCExto0AppGPHdDpeR/8/U7UVcVLxiulYRkXM4+HWEWRgGW0zByzaJJ3ikxKmqUmRFY3IZFkp/E3jmlDRAy0wy/VASq2kEYkFW6JkpSdrq4mJBmKwSBROLXS1BCVwdi472ruJyERRXYcBTNrWdSrU+YTYPC1jMQamlWkV5Ux2nLq9pVNlAePW3oVPaK+a5rROGhmUU+8V+ZTk3bdMjXbNOW6iw98NqEVnVgc3BSvpbsJ0D+hew0hBLZFpmTXMmA3rEowlORJrLat6gO19ybdd87hpzuZL86zIx4tZojsv0a3s16JTxlnqq7SlW1/besoxdQ1hXUlLdDGX45fR/0S+/gY=";

    pose = JSON.parse( decode( fm_pose ) );

    setTimeout( initPose, 3000, pose ); // TODO: to replace setTimeout.

    function initPose( json ){
        localPlayer.outfit.outfits.forEach( function( name ){
            if ( !!localPlayer.outfit[name] ) {
                json.forEach(function ( key, i ) {
                    localPlayer.outfit[name].skeleton.bones[i].position.fromArray( json[i].pos );
                    localPlayer.outfit[name].skeleton.bones[i].quaternion.fromArray( json[i].rot );
                    localPlayer.outfit[name].skeleton.bones[i].scale.fromArray( json[i].scl );
                });
            }
        });
    }

</script>

<script>

//  app.js

    var debugMode;
    var mouse = new THREE.Vector2();

    var rendererHalfWidth = renderer.domElement.width * 0.5;
    var rendererHalfHeight = renderer.domElement.height * 0.5;

    localPlayer.holder.visible = false;
    localPlayer.controller.center.set(0,1,0);
    localPlayer.controller.direction = Math.PI;
//  scene.add(localPlayer.outfit.direction);  //  IMPORTANT  //

    keyInputControls.Off();

//  Animate.

    animate();

    function animate(){

        windowAnimationFrameRequestID = requestAnimationFrame( animate );

        render();

        update();

    }

//  Event Listeners.

    $(window).on( "resize", onWindowResize );

    function onWindowResize() {
        camera.aspect = container.clientWidth / container.clientHeight;
        camera.updateProjectionMatrix();
        renderer.setSize( container.clientWidth, container.clientHeight );
        rendererHalfWidth = renderer.domElement.width * 0.5;
        rendererHalfHeight = renderer.domElement.height * 0.5;
    }

    $(window).on( "mousemove", onMouseMove );

    function onMouseMove( event ) {
        mouse.x = ( event.clientX - rendererHalfWidth );
        mouse.y = ( event.clientY - rendererHalfHeight );
    }

//  action-controls.html

    var actionHolderSelector = "#actions-holder";
    var actionControlsSelector = "#action-controls";
    var actionControlsComponent = componentsFolder + "action-controls.html";
    $(actionHolderSelector).load(actionControlsComponent, function(response, status, xhr){
        debugMode && console.log("action-controls:", status);
    });

</script>

</body>
</html>


<!-- ------------------------------------------------------------------------------------ -->

<!-- script>
/*
//  animation.js

    function Animation( name ){

        var avatar;
        var animation;

    //  Define "animationData" object 
    //  to create the init animation.

        var animation_data = {
            "name":"pose", 
            "fps":25, 
            "length": .001, 
            "hierarchy":[],
        };
    
    //  Prepear animationData for first init animation keys.
    
        avatar = localPlayer.outfit[ name ];
    
    //  Create the init key (time:0) for every bone of avatar in animationData.hierarchy.
        for (var i in avatar.skeleton.bones) {
            animation_data.hierarchy.push({"keys":[]});
            var init_animation_key = {"pos":[0,0,0], "rot":[0,0,0,1], "scl":[1,1,1], "time":0};
            init_animation_key.pos = avatar.skeleton.bones[i].position.toArray();
            init_animation_key.rot = avatar.skeleton.bones[i].quaternion.toArray();
            init_animation_key.scl = avatar.skeleton.bones[i].scale.toArray();
            animation_data.hierarchy[i].keys.push(init_animation_key);
        }
    
        console.log( "Animation data has been created:", animation_data );
    
    //  Create the animation.
        THREE.AnimationHandler.animations = [];
        animation = new THREE.Animation( avatar, animation_data );
        animation.isPlaying = false;
        animation.currentTime = 0;
        console.log("Animation has been created:", animation);
    
    //  Add an end-key at position 0.
    
        ensureLooping();
    
    //  Create a userData array to store rest pose.
    
        avatar.userData.restPose = [];
    
    //  Store init key as rest pose in userData.
    
        for (var i in animation.hierarchy) {
            var rest_pose_key = {"pos":[0,0,0], "rot":[0,0,0,1], "scl":[1,1,1]};
            rest_pose_key.pos = animation.hierarchy[i].position.toArray();
            avatar.userData.restPose.push( rest_pose_key );
        }
    
        console.log( "Rest pose has been saved:", avatar.userData.restPose );
    
    //  Play animation.
    //  animation.play(0);   // IMPORTANT //
    //  console.log("Animation is ready and is playing:", animation);

        return animation;

        function ensureLooping(){
            var lastkeyExists = false;
            var z = animation.data.hierarchy[0].keys.length - 1;
            var t = animation.data.length;
    
            if (animation.data.hierarchy[0].keys[z].time == t) {
                lastkeyExists = true;
            }
    
            for (var i in animation.data.hierarchy){
                var posloop = animation.data.hierarchy[i].keys[0].pos;
                var rotloop = animation.data.hierarchy[i].keys[0].rot;
                var sclloop = animation.data.hierarchy[i].keys[0].scl;
                var loopKeyData = {"index":z, "pos":posloop, "rot":rotloop, "scl":sclloop, "time":t};
            //  console.log("loopKeyData:", loopKeyData);
    
                if (lastkeyExists) {
                
                    var removedItems = 1;
                    animation.data.hierarchy[i].keys.splice(z, removedItems, loopKeyData);
                    
                } else {
    
                   var removedItems = 0;
                   loopKeyData.index = animation.data.hierarchy[0].keys.length;   // index correction.
                   animation.data.hierarchy[i].keys.push(loopKeyData);
                }
    
            }
            console.log("Ensure Looping completed.");
        }
    
        function ensureKeysIndexing(){
            for (var i in animation.data.hierarchy){
                for (var j in animation.data.hierarchy[i].keys){
                    animation.data.hierarchy[i].keys[j].index = Number(j);
                }
            }
            console.log("Ensure Keys Indexing completed.");
        }

    }
*/

/*
//  localPlayerFromDNA.js

    function localPlayerFromDNA( dna ){
        var frontAngle = Math.PI - cameraControls.getFrontAngle(); // face front.
        localPlayer.controller.direction = frontAngle;
        localPlayer.outfit.fromDNA( dna );
        scene.add(localPlayer.outfit.direction);
        localPlayer.outfit.update();
    }
*/

/*
//  poseToJSON.js

    function poseToJSON( skinned ){
        var pose = [];

        for (var i in skinned.skeleton.bones) {
            var key = {}; // {"pos":[], "rot":[], "scl":[]};
            key.pos = skinned.skeleton.bones[i].position.toArray();
            key.rot = skinned.skeleton.bones[i].quaternion.toArray();
            key.scl = skinned.skeleton.bones[i].scale.toArray();
            pose.push(key);
        }

        debugMode && console.log("pose:", pose);

        var json = JSON.stringify(pose);

        debugMode && console.log("json:", json);
        return json;
    }

//  poseFromJSON.js

    function poseFromJSON( text, skinned ){
        var pose = JSON.parse( text );
        pose.forEach(function ( key, i ) {
            skinned.skeleton.bones[i].position.fromArray( pose[i].pos );
            skinned.skeleton.bones[i].quaternion.fromArray( pose[i].rot );
            skinned.skeleton.bones[i].scale.fromArray( pose[i].scl );
        });
    }

//  saveJSONtoFile.js

    function saveJSONtoFile( json, name ){
        if ( !!json ){
            var blob = new Blob([ json ], {type: "application/json"});
            var url  = URL.createObjectURL(blob);
            var a = document.createElement("a");
            a.download = name + ".json";
            a.href = url;
            $(a).one("click", function(){
                URL.revokeObjectURL( url );
                $(a).remove();
            });
        //  a.style.display = "none";
        //  document.body.appendChild(a);
            a.click();
        }
    }

//  destroyClickedElement.js

    function destroyClickedElement(e) {
    	document.body.removeChild(e.target);
    }
*/

/*
//  exportAnimationPoseAsJSON.js

    function exportAnimationPoseAsJSON(){
        console.log("Exporting animation key Pose as JSON.");
        var poseExport = [];
        for (var i in animation.hierarchy) {
        //  Create a new animation data key with current time bones values.
        //  var poseKey = {"index":0, "pos":[], "rot":[], "scl":[], "time":0};
            var poseKey = {"pos":[], "rot":[], "scl":[]};
        //  Get bones values at current time from animation.hierarchy.
            poseKey.pos = animation.hierarchy[i].position.toArray();
            poseKey.rot = (animation.hierarchy[i].quaternion).toArray();
            poseKey.scl = animation.hierarchy[i].scale.toArray();
            poseExport.push(poseKey);
        }
        poseExport = JSON.stringify(poseExport);
        debugMode && console.log(poseExport);
        alert("Animation pose exported succesfully.");
        return poseExport;
    }
*/

/*
//  animation-jump-loader.js
//  from: "/js/loaders/animationsLoader.js"

    var animationsFolder = "/animations/";
    var jumpUrl = animationsFolder + "basic_jumping_animation_1.5sec.js";
    var hmJumpUrl = animationsFolder + "male_jumping_animation_2sec_v5.js";
    var hfJumpUrl = animationsFolder + "female_jumping_animation_2sec_v8.js";

    $getAnimation({
        url:jumpUrl, 
        key:"/animations/null/jump", 
        name:"jump", 
        obj:Animations
    });

    $getAnimation({
        url:hmJumpUrl, 
        key:"/animations/male/jump", 
        name:"jump", 
        obj:MaleAnimations
    });

    $getAnimation({
        url:hfJumpUrl, 
        key:"/animation/female/jump", 
        name:"jump", 
        obj:FemaleAnimations
    });

    function $getAnimation( options ){

        var url = options.url;
        var key = options.key;
        var name = options.name;
        var object = options.obj;

        AW3D_Cache.getItem(url).then(function(result){

        //  debugMode && console.log("result:", result);

            if ( !result || JSON.stringify(result) == "{}" ) {

                debugMode && console.log("Animations:", "Getting from web.");

                return $getJSON( options );

            } else {

                debugMode && console.log("Animations:", "Getting from cache.");

                object[ name ] = result;
                if ( !!localPlayer && !!localPlayer.outfit ) {
                    localPlayer.outfit.AnimationsHandler.refresh();
                }
            }

        }).catch(function(err) {
            console.error(err);
        });

        function $getJSON(options){

            var url = options.url;
            var key = options.key;
            var name = options.name;
            var object = options.obj;

            return $.getJSON( url, function(data){

                AW3D_Cache.setItem(url, data).then(function(result){

                    if (!result) {
                        var err = [ 
                            "AW3D Cache Error:", 
                            "No result returned:", 
                            result,
                        ].join(" ");
                        console.error(err);
                        throw Error(err);

                    } else if ( JSON.stringify(result) == "{}" ) {
                        var err = [ 
                            "AW3D Cache Warning:", 
                            "empty object returned:", 
                            JSON.stringify(result),
                        ].join(" ");
                        console.warn(err);
                        throw Error(err);

                    } else {
                        console.log("AW3D Cache:", "success!");
                        object[ name ] = result;
                        if ( !!localPlayer && !!localPlayer.outfit ) {
                            localPlayer.outfit.AnimationsHandler.refresh();
                        }
                    }
                    
                }).catch(function(err) {
                    console.log(err);
                    throw Error(err);
                });

            });
        }
    }
*/
</script -->











